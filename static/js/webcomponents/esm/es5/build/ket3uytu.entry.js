/*! Built with http://stenciljs.com */
import{h}from"../webcomponents.core.js";import{a as anime}from"./chunk-55a98941.js";import{a as menuFlyoutReducer,b as MenuFlyoutActionTypes}from"./chunk-bc34555f.js";import{a as createAndInstallStore,b as mapStateToProps}from"./chunk-6a8011c5.js";import{e as parseFunction}from"./chunk-c2033b1f.js";var MenuFlyout=function(){function t(){this.invokeDisplayChangeCallback=function(){return null},this.animationDuration=300,this.isClicking=!1,this.isHovering=!1,this.oppositeDirection={x:{"top-right":"top-left","top-left":"top-right","bottom-right":"bottom-left","bottom-left":"bottom-right"},y:{"top-right":"bottom-right","top-left":"bottom-left","bottom-right":"top-right","bottom-left":"top-left"}},this.easing={inQuadOutQuint:[.55,.085,.32,1]},this.arrowUnrotatedWidth=14,this.offset=16,this.display="closed",this.direction="bottom-right",this.closeOnClick=!1}return t.prototype.directionChanged=function(){var t=this;"closed"!==this.display?this.close().then(function(){t.dispatchDirection(t.direction),t.open()}):this.dispatchDirection(this.direction)},t.prototype.toggleElChanged=function(){this.toggleElChild=this.toggleEl?this.toggleEl.children[0]:void 0},t.prototype.displayChangeCallbackChanged=function(){this.setInvokeDisplayChangeCallback()},t.prototype.componentWillLoad=function(){this.setInvokeDisplayChangeCallback(),this.store=createAndInstallStore(this,menuFlyoutReducer,this.getInitialState()),this.unsubscribe=mapStateToProps(this,this.store,["display","directionState","contentEl","toggleEl","arrowEls"]),this.dispatchDirection(this.direction),this.store.dispatch({type:MenuFlyoutActionTypes.setToggle,toggle:this.toggle.bind(this)})},t.prototype.displayChanged=function(){this.invokeDisplayChangeCallback(this.display)},t.prototype.componentDidLoad=function(){this.close()},t.prototype.componentDidUnload=function(){this.unsubscribe()},t.prototype.getInitialState=function(){return{display:"closed",directionState:"bottom-right",toggle:function(){return Promise.resolve()},contentEl:void 0,toggleEl:void 0,arrowEls:[]}},t.prototype.onClick=function(){this.isClicking=!0},t.prototype.onWindowClick=function(){(!this.isClicking||"open"===this.display&&this.closeOnClick)&&this.close(),this.isClicking=!1},t.prototype.onMouseEnter=function(){this.isHovering=!0,this.open()},t.prototype.onMouseLeave=function(){var t=this;setTimeout(function(){t.isHovering||t.close()},400),this.isHovering=!1},t.prototype.toggle=function(){return"open"===this.display?this.close():"closed"===this.display?this.open():Promise.resolve()},t.prototype.open=function(){var t=this;return new Promise(function(e){if(t.contentEl)if("closed"===t.display||"closing"===t.display){var o=t.contentEl,i=t.directionState;t.store.dispatch({type:MenuFlyoutActionTypes.setDisplay,display:"opening"}),o.style.display="block",t.positionContentEl(i);var n,s=t.hasEnoughSpace(i,"x"),l=t.hasEnoughSpace(i,"y");s||(t.positionContentEl(n=t.oppositeDirection.x[i],"x"),t.hasEnoughSpace(n,"x")?t.dispatchDirection(i=n):t.positionContentEl(n,"x",!0)),l||(t.positionContentEl(n=t.oppositeDirection.y[i],"y"),t.hasEnoughSpace(n,"y")?t.dispatchDirection(n):t.positionContentEl(i,"y"));var a="top-left"===t.directionState||"top-right"===t.directionState?-t.offset:t.offset;anime.remove(o),anime({targets:o,duration:t.animationDuration,translateY:a,opacity:1,easing:t.easing.inQuadOutQuint,complete:function(){t.store.dispatch({type:MenuFlyoutActionTypes.setDisplay,display:"open"}),e()}})}else e()})},t.prototype.close=function(){var t=this;return new Promise(function(e){var o=t.contentEl;o&&("closed"===t.display?(o.style.display="none",o.style.opacity="0",e()):(t.store.dispatch({type:MenuFlyoutActionTypes.setDisplay,display:"closing"}),anime.remove(o),anime({targets:o,duration:t.animationDuration,translateY:0,opacity:0,easing:t.easing.inQuadOutQuint,complete:function(){o.style.display="none",t.dispatchDirection(t.direction),t.store.dispatch({type:MenuFlyoutActionTypes.setDisplay,display:"closed"}),e()}})))})},t.prototype.setInvokeDisplayChangeCallback=function(){this.invokeDisplayChangeCallback=parseFunction(this.displayChangeCallback)},t.prototype.dispatchDirection=function(t){this.store.dispatch({type:MenuFlyoutActionTypes.setDirectionState,directionState:t})},t.prototype.hasEnoughSpace=function(t,e){if(!this.contentEl)return!1;var o=this.el.getBoundingClientRect(),i=this.contentEl.getBoundingClientRect();switch(e){case"x":return i.width<("top-left"===t||"bottom-left"===t?o.left:innerWidth-o.left);case"y":var n=void 0,s=void 0;return"bottom-right"===t||"bottom-left"===t?s=(n=innerHeight-o.bottom)-(innerHeight-i.bottom):(n=o.top,s=innerHeight-(innerHeight-o.top)-i.top),(s+=this.offset)<n;default:return!0}},t.prototype.positionContentEl=function(t,e,o){var i=this;if(this.contentEl&&this.toggleEl){var n=this.contentEl,s=this.getContentElPosition(t);if(this.contentEl.style.opacity="0",this.contentEl.style.transform="translateY(0)",e&&"x"!==e||(this.contentEl.style.left=s[0]+"px"),e&&"y"!==e||(this.contentEl.style.top=s[1]+"px"),o){n.style.width=innerWidth-2*this.offset+"px";var l=this.toggleEl.getBoundingClientRect();n.style.left="-"+(l.left-this.offset)+"px";var a=this.getContentElPosition(t);n.style.top=a[1]+"px"}var r=this.contentEl.getBoundingClientRect(),c=this.toggleEl.getBoundingClientRect();this.arrowEls.forEach(function(t){t.style.left=c.left-r.left+c.width/2-i.arrowUnrotatedWidth/2+"px"})}},t.prototype.getContentElPosition=function(t){if(!this.contentEl||!this.toggleElChild)return[0,0];var e=this.contentEl.getBoundingClientRect(),o=this.toggleElChild.getBoundingClientRect(),i=-e.height,n=o.height,s=o.width/2-(this.offset+this.arrowUnrotatedWidth),l=-(e.width-o.width)-s;switch(t){case"bottom-right":return[s,n];case"bottom-left":return[l,n];case"top-right":return[s,i];case"top-left":return[l,i];default:return[0,0]}},t.prototype.render=function(){return h("slot",null)},Object.defineProperty(t,"is",{get:function(){return"sdx-menu-flyout"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{arrowEls:{state:!0},close:{method:!0},closeOnClick:{type:Boolean,attr:"close-on-click"},contentEl:{state:!0},direction:{type:String,attr:"direction",watchCallbacks:["directionChanged"]},directionState:{state:!0},display:{state:!0,watchCallbacks:["displayChanged"]},displayChangeCallback:{type:String,attr:"display-change-callback",watchCallbacks:["displayChangeCallbackChanged"]},el:{elementRef:!0},open:{method:!0},toggle:{method:!0},toggleEl:{state:!0,watchCallbacks:["toggleElChanged"]}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"listeners",{get:function(){return[{name:"click",method:"onClick"},{name:"touchend",method:"onClick",passive:!0},{name:"window:click",method:"onWindowClick"},{name:"window:touchend",method:"onWindowClick",passive:!0},{name:"mouseenter",method:"onMouseEnter",passive:!0},{name:"mouseleave",method:"onMouseLeave",passive:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return":host{-webkit-box-sizing:border-box;box-sizing:border-box}*,:after,:before{-webkit-box-sizing:inherit;box-sizing:inherit}:host{position:relative;display:inline-block}"},enumerable:!0,configurable:!0}),t}();export{MenuFlyout as SdxMenuFlyout};